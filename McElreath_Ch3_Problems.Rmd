---
title: "Chapter 3 McElreath"
author: "Wynne Moss"
date: "September 10, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, load libraries, include = FALSE}
library(rethinking)
```

# Chapter 3 Problems

## Easy problems

Setup using code 3.27 from book
```{r, gridapprox}
#possible values of p (proportion of water covering the globe)
p_grid <- seq(from =0, to = 1, length.out = 1000)
#this is a uniform prior with total area under the curve = 1
prior <- rep(1, 1000)
#likelihood of getting 6 W's out of 9 random samples, given each possible value of p in pgrid
likelihood <- dbinom (6, size = 9, prob = p_grid)
#in this case prior =1 and sum (posterior) = 1
posterior <- likelihood * prior
posterior <- posterior / sum(posterior)
set.seed(100)
#draw 10,000 samples from the posterior
#pull values from p_grid in proportion to their representation in the posterior distribution
samples <- sample(p_grid, prob = posterior, size = 1e4, replace = TRUE)
```

3E1: How much posterior prob lies below p = 0.2?
```{r}
sum(samples < 0.2)/length(samples)
```

3E2: How much posterior prob lies above p = 0.8?
```{r}
sum(samples > 0.8)/length(samples)
```

3E3: How much posterior lies between 0.2 and 0.8?
```{r}
sum(samples > 0.2 & samples < 0.8)/length(samples)
```

3E4: 20% of the posterior lies below which value of p?
```{r}
quantile(samples, probs = 0.2)
```

3E5: 20% of the posterior lies above which value of p?
```{r}
quantile(samples, probs = 0.8)
```

3E6: Which values of p contain the narrowest interval equal to 66% of the posterior prob?
```{r}
HPDI(samples, prob = 0.66)
```

3E7: Which values contain 66% of PP assuming equal PP above and below?
```{r}
PI(samples, prob = 0.66)
```

## Medium Problems

3M1: If there were 8W in 15 tosses, construct posterior distribution.
```{r}
p_grid <- seq(from =0, to = 1, length.out = 1000)
prior <- rep(1, 1000)
likelihood <- dbinom (8, size = 15, prob = p_grid)
posterior <- likelihood * prior
posterior <- posterior / sum(posterior)
```

3M2: Draw 10000 samples from grid approximation and calculate 90% HDPI
```{r}
set.seed(100)
samples <- sample(p_grid, prob = posterior, size = 1e4, replace = TRUE)
HPDI(samples, prob = 0.9)
```

3M3: Construct a posterior predictive check. Simulate distribution of samplse averaging over the posterior uncertainty in p. What is the p of observing 8/15?
```{r}
w <- rbinom(1e4, size = 15, prob = samples)
hist(w)
sum(w==8)/1e4
```

3M4: Using new posterior, calcualte prob of 6w in 9 tosses
```{r}
w2 <- rbinom(1e4, size = 9, prob = samples)
hist(w2)
sum(w2==6)/1e4
```

3M5: add a prior that is zero below p = 0.5 and constant above p = .5. 
```{r}
p_grid <- seq(from =0, to = 1, length.out = 1000)
prior2 <- c(rep(0, 500), rep(1, 500))
likelihood2 <- dbinom (8, size = 15, prob = p_grid)
posterior2 <- likelihood * prior2
posterior2 <- posterior2 / sum(posterior2)
plot(posterior2~p_grid, type = "l")
samples2 <- sample(p_grid, prob = posterior2, size = 1e4, replace = TRUE)
HPDI(samples2, prob = 0.9)
w3 <- rbinom(1e4, size = 15, prob = samples2)
simplehist(w3)
simplehist(w)
```

## Hard problems
Introduction
```{r, include = FALSE}
data(homeworkch3)
birth1
birth2
```

